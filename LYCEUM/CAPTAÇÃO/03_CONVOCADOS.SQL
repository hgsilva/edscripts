-- GERANDO OS CANDIDATOS CONVOCADOS ACUMULADOS

-- GERA LOG


INSERT INTO IE_CANDIDATO_CONVOCADO_ACUMULADO_V3_LOG

SELECT	*, GETDATE()DT_LOG 
FROM	IE_CANDIDATO_CONVOCADO_ACUMULADO_V3
where	ano	IN (
				SELECT	DISTINCT ANO
				FROM	[POLARIS02\BDIESBPROD].LYCEUM.DBO.IE_LY_OPCOES_APP
				WHERE	APLICACAO in ( 'VESTIBULAR','VESTIBULAR_EAD_TRIMESTRAL')
				)


-- LIMPA A TB
delete IE_CANDIDATO_CONVOCADO_ACUMULADO_V3 where ano IN (
														SELECT	DISTINCT ANO
														FROM	[POLARIS02\BDIESBPROD].LYCEUM.DBO.IE_LY_OPCOES_APP
														WHERE	APLICACAO in ( 'VESTIBULAR','VESTIBULAR_EAD_TRIMESTRAL')
														)


-- GERA OS DADOS
insert into IE_CANDIDATO_CONVOCADO_ACUMULADO_V3
select	CANDIDATO
		,CONCURSO
		,ANO
		,SEMESTRE
		,A.CURSO
		--,case when grupo_curso is null then faculdade else grupo_curso end CAMPUS
		,CAMPI AS CAMPUS
		,A.MODALIDADE
		,TIPO_CONCURSO
		,GETDATE()DT_INSCRICAO
		,GETDATE()DATA
		,TURNO 
from	[POLARIS02\BDIESBPROD].LYCEUM.DBO.VW_PAINEL_TURMAS_TODOSPERIODOS a --VW_PAINEL_TURMAS a
left join	ly_curso b on a.curso = b.curso
where	CONVOCADO = '1'


